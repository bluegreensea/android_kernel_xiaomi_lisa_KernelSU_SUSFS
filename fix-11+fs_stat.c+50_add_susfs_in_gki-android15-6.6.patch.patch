--- a/50_add_susfs_in_gki-android15-6.6.patch
+++ b/50_add_susfs_in_gki-android15-6.6.patch
@@ -1803,9 +1803,9 @@
 index 517fa4ed885e..8a0d587c0a69 100644
 --- a/fs/stat.c
 +++ b/fs/stat.c
-@@ -20,12 +20,19 @@
+@@ -20,9 +20,16 @@
+ #include <linux/pagemap.h>
  #include <linux/compat.h>
- #include <linux/iversion.h>
  
 +#if defined(CONFIG_KSU_SUSFS_SUS_KSTAT) || defined(CONFIG_KSU_SUSFS_SUS_SU)
 +#include <linux/susfs_def.h>
@@ -1813,20 +1813,17 @@
  #include <linux/uaccess.h>
  #include <asm/unistd.h>
  
- #include "internal.h"
- #include "mount.h"
- 
 +#ifdef CONFIG_KSU_SUSFS_SUS_KSTAT
 +extern void susfs_sus_ino_for_generic_fillattr(unsigned long ino, struct kstat *stat);
 +#endif
 +
  /**
   * generic_fillattr - Fill in the basic attributes from the inode struct
-  * @idmap:		idmap of the mount the inode was found from
+  * @inode: Inode to use as the source
 @@ -49,6 +56,19 @@ void generic_fillattr(struct mnt_idmap *idmap, u32 request_mask,
- 	vfsuid_t vfsuid = i_uid_into_vfsuid(idmap, inode);
- 	vfsgid_t vfsgid = i_gid_into_vfsgid(idmap, inode);
- 
+  */
+ void generic_fillattr(struct inode *inode, struct kstat *stat)
+ {
 +#ifdef CONFIG_KSU_SUSFS_SUS_KSTAT
 +	if (likely(susfs_is_current_proc_umounted()) &&
 +	    unlikely(inode->i_mapping->flags & BIT_SUS_KSTAT))
@@ -1834,8 +1831,8 @@
 +		susfs_sus_ino_for_generic_fillattr(inode->i_ino, stat);
 +		stat->mode = inode->i_mode;
 +		stat->rdev = inode->i_rdev;
-+		stat->uid = vfsuid_into_kuid(vfsuid);
-+		stat->gid = vfsgid_into_kgid(vfsgid);
++		stat->uid = inode->i_uid;
++		stat->gid = inode->i_gid;
 +		return;
 +	}
 +#endif
@@ -1844,8 +1841,8 @@
  	stat->ino = inode->i_ino;
  	stat->mode = inode->i_mode;
 @@ -271,6 +291,12 @@ static int vfs_statx(int dfd, struct filename *filename, int flags,
- 	return error;
  }
+ EXPORT_SYMBOL(vfs_statx_fd);
  
 +#ifdef CONFIG_KSU_SUSFS_SUS_SU
 +extern bool susfs_is_sus_su_hooks_enabled __read_mostly;
@@ -1853,33 +1850,28 @@
 +extern struct filename* susfs_ksu_handle_stat(int *dfd, const char __user **filename_user, int *flags);
 +#endif
 +
- int vfs_fstatat(int dfd, const char __user *filename,
- 			      struct kstat *stat, int flags)
- {
-@@ -295,7 +321,23 @@ int vfs_fstatat(int dfd, const char __user *filename,
- 			return vfs_fstat(dfd, stat);
- 	}
+ /**
+  * vfs_statx - Get basic and extra attributes by filename
+  * @dfd: A file descriptor representing the base dir for a relative filename
+@@ -172,6 +198,18 @@ int vfs_fstatat(int dfd, const char __user *filename,
+ 	int error = -EINVAL;
+ 	unsigned int lookup_flags = LOOKUP_FOLLOW | LOOKUP_AUTOMOUNT;
  
 +#ifdef CONFIG_KSU_SUSFS_SUS_SU
 +	if (likely(susfs_is_current_proc_umounted())) {
-+		goto orig_flow1;
++		goto orig_flow;
 +	}
 +	if (likely(susfs_is_sus_su_hooks_enabled) &&
 +		unlikely(__ksu_is_allow_uid(current_uid().val)))
 +	{
-+		name = susfs_ksu_handle_stat(&dfd, &filename, &statx_flags);
-+		goto orig_flow2;
++		susfs_ksu_handle_stat(&dfd, &filename, &flags);
 +	}
-+orig_flow1:
++orig_flow:
 +#endif
 +
- 	name = getname_flags(filename, getname_statx_lookup_flags(statx_flags), NULL);
-+#ifdef CONFIG_KSU_SUSFS_SUS_SU
-+orig_flow2:
-+#endif
- 	ret = vfs_statx(dfd, name, statx_flags, stat, STATX_BASIC_STATS);
- 	putname(name);
- 
+ 	if ((flags & ~(AT_SYMLINK_NOFOLLOW | AT_NO_AUTOMOUNT |
+ 		       AT_EMPTY_PATH | KSTAT_QUERY_FLAGS)) != 0)
+ 		return -EINVAL;
 diff --git a/fs/statfs.c b/fs/statfs.c
 index 2a37f9f3dba1..e56f577710cc 100644
 --- a/fs/statfs.c
